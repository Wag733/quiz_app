{% extends 'admins/base.html' %}

{% block content %}
  <div class="container">
    <h1 class="display-4">Edit Quiz: {{ quiz.title }}</h1>
    <hr>
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" class="btn btn-primary">Save Changes</button>
    </form>

    <h2 class="mt-4">Questions:</h2>
    <ul class="list-group">
      {% for question in quiz.questions.all %}
        <li class="list-group-item">
          {{ question.text }}

          {% if question.question_type == 'MCQ' %}
            {% with mcq=question.mcqquestion %}
              <ul class="list-group list-group-flush">
                <li class="list-group-item">Choice 1: {{ mcq.choice1 }}</li>
                <li class="list-group-item">Choice 2: {{ mcq.choice2 }}</li>
                <li class="list-group-item">Choice 3: {{ mcq.choice3 }}</li>
                <li class="list-group-item">Choice 4: {{ mcq.choice4 }}</li>
                <li class="list-group-item">Correct Answer: {{ mcq.get_correct_answer_display }}</li>
              </ul>
            {% endwith %}
          
          {% elif question.question_type == 'MULTI_CORRECT' %}
            {% with multi=question.multicorrectquestion %}
              <ul class="list-group list-group-flush">
                <li class="list-group-item">Choice 1: {{ multi.choice1 }}</li>
                <li class="list-group-item">Choice 2: {{ multi.choice2 }}</li>
                <li class="list-group-item">Choice 3: {{ multi.choice3 }}</li>
                <li class="list-group-item">Choice 4: {{ multi.choice4 }}</li>
                <li class="list-group-item">Correct Answers: {{ multi.correct_answers }}</li>
              </ul>
            {% endwith %}

          {% elif question.question_type == 'SHORT' %}
            {% with short=question.shortanswerquestion %}
              <ul class="list-group list-group-flush">
                <li class="list-group-item">Correct Answer: {{ short.correct_answer }}</li>
              </ul>
            {% endwith %}

          {% elif question.question_type == 'TRUE_FALSE' %}
            {% with tf=question.truefalsequestion %}
              <ul class="list-group list-group-flush">
                <li class="list-group-item">Correct Answer: {{ tf.correct_answer|yesno:"True,False" }}</li>
              </ul>
            {% endwith %}

          {% elif question.question_type == 'FILL_BLANK' %}
            {% with fill=question.fillintheblankquestion %}
              <ul class="list-group list-group-flush">
                <li class="list-group-item">Correct Answers: {{ fill.correct_answers }}</li>
              </ul>
            {% endwith %}
          {% endif %}
          
          <div class="float-right">
            <a href="{% url 'delete_question' question.pk %}" class="btn btn-sm btn-danger">Delete</a>
            <a href="{% url 'edit_question' quiz.pk question.pk %}" class="btn btn-sm btn-primary">Edit</a>
          </div>
        </li>
      {% empty %}
        <li class="list-group-item">No questions yet.</li>
      {% endfor %}
    </ul>

    <p class="mt-3">
      <a href="{% url 'create_question' quiz.pk %}" class="btn btn-primary">Add New Question</a>
    </p>

    <p class="mt-3">
      <a href="{% url 'delete_quiz' quiz.pk %}" class="btn btn-danger">Delete Quiz</a>
    </p>
  </div>
{% endblock %}
